<?xml version="1.0" encoding="UTF-8" ?>
<!-- $Header: /cvsroot/autodoc/autodoc/xml.tmpl,v 1.2 2006/05/16 19:01:27 rbt Exp $ -->

<book id="database.tagaprice" xreflabel="tagaprice database schema"><title>tagaprice Model</title>




  <chapter id="public.schema"
           xreflabel="public">
    <title>Schema public</title>
    <para>standard public schema</para>


      <section id="public.table.account"
               xreflabel="public.account">
        <title id="public.table.account-title">
         Table:
         
         <structname>account</structname>
        </title>
 

        <para>
          Stores information concerning any user accounts in tagaprice. User accounts may be local or from other systems, e.g. OAuth
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>account</structname>
            </title>


            <varlistentry>
              <term><structfield>uid</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.entity"/>


              </para>

              <para>
                Globally unique id to identify an entity, i.e. the account in this case.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>mail</structfield></term>
              <listitem><para>
                <type>character varying(200)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>last_login</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>locked</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing confirmaccount via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="public.table.confirmaccount"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.entity"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.entityrevision"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.localaccount"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.session"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.brand"
               xreflabel="public.brand">
        <title id="public.table.brand-title">
         Table:
         
         <structname>brand</structname>
        </title>
 

        <para>
          Represents a brand, e.g. Addidas, Nike, etc
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>brand</structname>
            </title>


            <varlistentry>
              <term><structfield>brand_id</structfield></term>
              <listitem><para>
                <type>bigint</type>






                <literal>PRIMARY KEY</literal>












                <literal>REFERENCES</literal> <xref linkend="public.table.entity"/>




              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing productrevision via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="public.table.productrevision"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.confirmaccount"
               xreflabel="public.confirmaccount">
        <title id="public.table.confirmaccount-title">
         Table:
         
         <structname>confirmaccount</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>confirmaccount</structname>
            </title>


            <varlistentry>
              <term><structfield>uid</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.account"/>


              </para>

              <para>
                Globally unique id to identify an entity, i.e. the associated account/user in this case.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>confirm</structfield></term>
              <listitem><para>
                <type>character varying(200)</type>







              </para>

              <para>
                A token to confirm an account.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>confirm_date</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

              <para>
                The date until the confirm-token is valid.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.country"
               xreflabel="public.country">
        <title id="public.table.country-title">
         Table:
         
         <structname>country</structname>
        </title>
 

        <para>
          Associates a country code with a title and a tocal title.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>country</structname>
            </title>


            <varlistentry>
              <term><structfield>country_code</structfield></term>
              <listitem><para>
                <type>character(2)</type>


                <literal>PRIMARY KEY</literal>













              </para>

              <para>
                The unqiue country code for a country.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>title</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                The title or name for a country.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>localtitle</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

              <para>
                The localized title or name for a country.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing shoprevision via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="public.table.shoprevision"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.currency"
               xreflabel="public.currency">
        <title id="public.table.currency-title">
         Table:
         
         <structname>currency</structname>
        </title>
 

        <para>
          Represents a currency, e.g. euro, dollar, etc
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>currency</structname>
            </title>


            <varlistentry>
              <term><structfield>currency_id</structfield></term>
              <listitem><para>
                <type>bigint</type>






                <literal>PRIMARY KEY</literal>












                <literal>REFERENCES</literal> <xref linkend="public.table.entity"/>




              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.entity"
               xreflabel="public.entity">
        <title id="public.table.entity-title">
         Table:
         
         <structname>entity</structname>
        </title>
 

        <para>
          The base entity of almost all entities. It provides basic information such as creator, create time, current revision and local. 
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>entity</structname>
            </title>


            <varlistentry>
              <term><structfield>ent_id</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                A unique id identifying a single entity.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>locale_id</structfield></term>
              <listitem><para>
                <type>integer</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="public.table.locale"/>


              </para>

              <para>
                Id indicating the local of this entity.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>created_at</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

              <para>
                The timestamp when this entity has been created.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>current_revision</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                Entities are revisionable. This number indicates the current revision of this entity.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>creator</structfield></term>
              <listitem><para>
                <type>bigint</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="public.table.account"/>


              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on entity</title>

          <varlistentry>
            <term>entity_current_revision_check</term>
            <listitem><para>CHECK ((current_revision &gt;= 1))</para></listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing account via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="public.table.account"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.brand"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.currency"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.entityproperty"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.entityrevision"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.product"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.producttype"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.property"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.receipt"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.receiptentry"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.shop"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.unit"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.entityproperty"
               xreflabel="public.entityproperty">
        <title id="public.table.entityproperty-title">
         Table:
         
         <structname>entityproperty</structname>
        </title>
 

        <para>
          Any entity may have any number of properties. This table stores the entity-specific or &quot;dynamic&quot; data of a property for a concrete entity. E.g. for a property weight and an associated product, this table stores data like the value. &quot;Static&quot; or property-specific data is stored in propertyRevision.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>entityproperty</structname>
            </title>


            <varlistentry>
              <term><structfield>eprop_id</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

              <para>
                The locally unique id to identify an assignement of a property for a particular entity.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>prop_id</structfield></term>
              <listitem><para>
                <type>bigint</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="public.table.property"/>


              </para>

              <para>
                The id of the associated property, as stored in table property.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ent_id</structfield></term>
              <listitem><para>
                <type>bigint</type>















                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="public.table.entity"/>



                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>



                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                The entity this property belongs to.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>value</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                The value of the assignement. E.g. the entity/product &quot;milk&quot; may have the property &quot;amount&quot; with value=&quot;100&quot; (mililiter, where the unit is mililiter).
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>unit_id</structfield></term>
              <listitem><para>
                <type>bigint</type>












                <literal>REFERENCES</literal> <xref linkend="public.table.unit"/>


              </para>

              <para>
                The unit of this property, e.g. for a property with title &quot;weight&quot; this references to a unit &quot;kg&quot;.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>min_rev</structfield></term>
              <listitem><para>
                <type>integer</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                Min_rev and max_rev indicate the span of life for the property, i.e. from which revision to which revision of the corresponding entity the property is valid.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>max_rev</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                Min_rev and max_rev indicate the span of life for the property, i.e. from which revision to which revision of the corresponding entity the property is valid. Max_rev may be null to indicate that the property is still associated to the corresponding entity.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on entityproperty</title>

          <varlistentry>
            <term>entityproperty_check</term>
            <listitem><para>CHECK ((min_rev &lt;= max_rev))</para></listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.entityrevision"
               xreflabel="public.entityrevision">
        <title id="public.table.entityrevision-title">
         Table:
         
         <structname>entityrevision</structname>
        </title>
 

        <para>
          Represents a certain revision of any entity. When saving a new (at least one column is different) revision of an entity, a new revision should be created. Identical values are saved twice. Branches are not possible, i.e. the only branch is the master branch.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>entityrevision</structname>
            </title>


            <varlistentry>
              <term><structfield>ent_id</structfield></term>
              <listitem><para>
                <type>bigint</type>






                <literal>PRIMARY KEY</literal>












                <literal>REFERENCES</literal> <xref linkend="public.table.entity"/>




              </para>

              <para>
                Globally unique id to identify an entity, i.e. the entitiy revision in this case.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>rev</structfield></term>
              <listitem><para>
                <type>integer</type>


                <literal>PRIMARY KEY</literal>













              </para>

              <para>
                The number of this revision. Rev must be equal or great than 0. Since branching is not possible, the rev values for one particualr product is a consecutive sequence of numbers without gaps in between.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>title</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                The title of this entityrevision, e.g. for a product the productname.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>created_at</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

              <para>
                The time when the entity revision has been created.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>group_id</structfield></term>
              <listitem><para>
                <type>bigint</type>












                <literal>REFERENCES</literal> <xref linkend="public.table.entity"/>


              </para>

              <para>
                Identifies the group this entity (revision) belongs to. A group is used to connect different locales of an entity to each other forming a group.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>creator</structfield></term>
              <listitem><para>
                <type>bigint</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="public.table.account"/>


              </para>

              <para>
                The creator of this revision, i.e. a reference to their account.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on entityrevision</title>

          <varlistentry>
            <term>entityrevision_rev_check</term>
            <listitem><para>CHECK ((rev &gt;= 1))</para></listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing entity via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="public.table.entity"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.entityproperty"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.productrevision"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.propertyrevision"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.shoprevision"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.typerevision"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.unitrevision"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.localaccount"
               xreflabel="public.localaccount">
        <title id="public.table.localaccount-title">
         Table:
         
         <structname>localaccount</structname>
        </title>
 

        <para>
          Stores information about a local accout for a user. Local account, in contrast to accounts like OAuth accounts, store their passwords locally at TagAPrice.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>localaccount</structname>
            </title>


            <varlistentry>
              <term><structfield>uid</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.account"/>


              </para>

              <para>
                Globally unique id to identify an entity, i.e. the associated account/user in this case.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>password</structfield></term>
              <listitem><para>
                <type>character varying(32)</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                The Password of the local account.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>salt</structfield></term>
              <listitem><para>
                <type>character(10)</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                The salt code for the password
              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.locale"
               xreflabel="public.locale">
        <title id="public.table.locale-title">
         Table:
         
         <structname>locale</structname>
        </title>
 

        <para>
          Used for language localization to provide translations for other languages. An entity has a local providing information about the language of the entity.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>locale</structname>
            </title>


            <varlistentry>
              <term><structfield>locale_id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

              <para>
                Id to identify a local.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fallback_id</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="public.table.locale"/>


              </para>

              <para>
                Reference to a local which can be used as fallback, e.g. if current local does not provide a localtitle.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>title</structfield></term>
              <listitem><para>
                <type>character varying(50)</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                The name of the language of the associated entity in English.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>localtitle</structfield></term>
              <listitem><para>
                <type>character varying(50)</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                The name of the language of the associated entity in the language.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>created_at</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

              <para>
                The time when the local has been created
              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing entity via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="public.table.entity"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.locale"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.product"
               xreflabel="public.product">
        <title id="public.table.product-title">
         Table:
         
         <structname>product</structname>
        </title>
 

        <para>
          Represents a particular product
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>product</structname>
            </title>


            <varlistentry>
              <term><structfield>prod_id</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.entity"/>


              </para>

              <para>
                Globally unique id to identify an entity, i.e. the product in this case.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing productrevision via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="public.table.productrevision"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.productrevision"
               xreflabel="public.productrevision">
        <title id="public.table.productrevision-title">
         Table:
         
         <structname>productrevision</structname>
        </title>
 

        <para>
          Stores information for products.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>productrevision</structname>
            </title>


            <varlistentry>
              <term><structfield>prod_id</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>






















                <literal>REFERENCES</literal> <xref linkend="public.table.product"/>



                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                Globally unique id to identify an entity, i.e. the product revision in this case.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>rev</structfield></term>
              <listitem><para>
                <type>integer</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                The revision of the product.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>type_id</structfield></term>
              <listitem><para>
                <type>bigint</type>












                <literal>REFERENCES</literal> <xref linkend="public.table.producttype"/>


              </para>

              <para>
                The associated product type, i.e. the product category. May be NULL if product is not associated to any category.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>brand_id</structfield></term>
              <listitem><para>
                <type>bigint</type>












                <literal>REFERENCES</literal> <xref linkend="public.table.brand"/>


              </para>

              <para>
                The associated brand for the product. May be NULL.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>imageurl</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

              <para>
                The URL for an image of the product.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.producttype"
               xreflabel="public.producttype">
        <title id="public.table.producttype-title">
         Table:
         
         <structname>producttype</structname>
        </title>
 

        <para>
          Product may be have one associated category or type, e.g. &quot;Milk Products&quot;. This table stores ids of all categories/types.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>producttype</structname>
            </title>


            <varlistentry>
              <term><structfield>type_id</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.entity"/>


              </para>

              <para>
                Globally unique id to identifies an entity, i.e. the productType in this case.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing productrevision via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="public.table.productrevision"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.typerevision"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.property"
               xreflabel="public.property">
        <title id="public.table.property-title">
         Table:
         
         <structname>property</structname>
        </title>
 

        <para>
          Stores the ids of any properties defined.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>property</structname>
            </title>


            <varlistentry>
              <term><structfield>prop_id</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.entity"/>


              </para>

              <para>
                Globally unique id to identify an entity, i.e. the property in this case.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing entityproperty via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="public.table.entityproperty"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.propertyrevision"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.propertyrevision"
               xreflabel="public.propertyrevision">
        <title id="public.table.propertyrevision-title">
         Table:
         
         <structname>propertyrevision</structname>
        </title>
 

        <para>
          Stores revisionable data of properties. Check entityproperty for more information about properties.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>propertyrevision</structname>
            </title>


            <varlistentry>
              <term><structfield>prop_id</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>






















                <literal>REFERENCES</literal> <xref linkend="public.table.property"/>



                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                Globally unique id to identify an entity, i.e. the propertyRevision in this case.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>rev</structfield></term>
              <listitem><para>
                <type>integer</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                The revision of the property.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(50)</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                An identifier similiar to a variable in programming code, for clients to identify the property. Must be in English. E.g. &quot;weight&quot; for a property with title=&quot;Weight&quot;
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>minvalue</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

              <para>
                For countable properties boundaries may be defined by using minValue and maxValue.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>maxvalue</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

              <para>
                For countable properties boundaries may be defined by using minValue and maxValue.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>type</structfield></term>
              <listitem><para>
                <type>propertytype</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                The datatype of the property. One of &quot;string&quot;,&quot;double&quot; or &quot;int&quot;
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>uniq</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

              <para>
                Indicates if a property may be used multiple times for a single entity.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>unit_id</structfield></term>
              <listitem><para>
                <type>bigint</type>












                <literal>REFERENCES</literal> <xref linkend="public.table.unit"/>


              </para>

              <para>
                The unit of the property, if available.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on propertyrevision</title>

          <varlistentry>
            <term>propertyrevision_name_check</term>
            <listitem><para>CHECK (((length((name)::text) &gt; 0) AND (substr((name)::text, 0, 1) = lower(substr((name)::text, 0, 1)))))</para></listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.receipt"
               xreflabel="public.receipt">
        <title id="public.table.receipt-title">
         Table:
         
         <structname>receipt</structname>
        </title>
 

        <para>
          User add product information by providing receipts of purchases. This table stores the receipt data.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>receipt</structname>
            </title>


            <varlistentry>
              <term><structfield>rid</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.entity"/>


              </para>

              <para>
                Globally unique id to identify an entity, i.e. the receipt in this case.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sid</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

              <para>
                The shop where the receipt has been created.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>draft</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

              <para>
                Indicates whether the receipt is a draft or not.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>created_at</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

              <para>
                The time when the receipt has been created.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.receiptentry"
               xreflabel="public.receiptentry">
        <title id="public.table.receiptentry-title">
         Table:
         
         <structname>receiptentry</structname>
        </title>
 

        <para>
          User add product information by providing receipts of purchases. This table stores the data of entires of the receipt which are not associated to the product itself.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>receiptentry</structname>
            </title>


            <varlistentry>
              <term><structfield>pkey</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

              <para>
                An unique ID.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>rid</structfield></term>
              <listitem><para>
                <type>bigint</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="public.table.entity"/>


              </para>

              <para>
                The associated receipt.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>pid</structfield></term>
              <listitem><para>
                <type>bigint</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                The associated product.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>price</structfield></term>
              <listitem><para>
                <type>bigint</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                The price of the associated product as noted on the receipt.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.session"
               xreflabel="public.session">
        <title id="public.table.session-title">
         Table:
         
         <structname>session</structname>
        </title>
 

        <para>
          Represents a user session.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>session</structname>
            </title>


            <varlistentry>
              <term><structfield>uid</structfield></term>
              <listitem><para>
                <type>bigint</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="public.table.account"/>


              </para>

              <para>
                The id of the user associated to this user session.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sid</structfield></term>
              <listitem><para>
                <type>character(32)</type>


                <literal>PRIMARY KEY</literal>













              </para>

              <para>
                The unique session id for this user session.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>last_active</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

              <para>
                The time of the last request of the user indicated by uid. (so that we&apos;re able to detect expired sessions)
              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on session</title>

          <varlistentry>
            <term>session_uid_key</term>
            <listitem><para>uid</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="public.table.shop"
               xreflabel="public.shop">
        <title id="public.table.shop-title">
         Table:
         
         <structname>shop</structname>
        </title>
 

        <para>
          Stores the ids of shops.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>shop</structname>
            </title>


            <varlistentry>
              <term><structfield>shop_id</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.entity"/>


              </para>

              <para>
                Globally unique id to identifies an entity, i.e. the shop in this case.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing shoprevision via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="public.table.shoprevision"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.shoprevision"
               xreflabel="public.shoprevision">
        <title id="public.table.shoprevision-title">
         Table:
         
         <structname>shoprevision</structname>
        </title>
 

        <para>
          Stores all revisionable data of shops
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>shoprevision</structname>
            </title>


            <varlistentry>
              <term><structfield>shop_id</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>






















                <literal>REFERENCES</literal> <xref linkend="public.table.shop"/>



                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                Globally unique id to identify an entity, i.e. the shop in this case.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>rev</structfield></term>
              <listitem><para>
                <type>integer</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                The revision# of this shop
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>type_id</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

              <para>
                The type or category of the shop. Not implemented yet.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>imageurl</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

              <para>
                The url of an image of the shop.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>lat</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

              <para>
                A shop s position may be indicated by either latitude (lat) and longitude (lng) and/or by its street (incl. #), city and countrycode.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>lng</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

              <para>
                A shop s position may be indicated by either latitude (lat) and longitude (lng) and/or by its street (incl. #), city and countrycode.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>street</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

              <para>
                A shop s position may be indicated by either latitude (lat) and longitude (lng) and/or by its street (incl. #), city and countrycode.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>city</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

              <para>
                A shop s position may be indicated by either latitude (lat) and longitude (lng) and/or by its street (incl. #), city and countrycode.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>country_code</structfield></term>
              <listitem><para>
                <type>character(2)</type>












                <literal>REFERENCES</literal> <xref linkend="public.table.country"/>


              </para>

              <para>
                A shop s position may be indicated by either latitude (lat) and longitude (lng) and/or by its street (incl. #), city and countrycode.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on shoprevision</title>

          <varlistentry>
            <term>shoprevision_check</term>
            <listitem><para>CHECK (((lat IS NULL) = (lng IS NULL)))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>shoprevision_lat_check</term>
            <listitem><para>CHECK (((lat &gt;= ((-90))::double precision) AND (lat &lt;= (90)::double precision)))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>shoprevision_lng_check</term>
            <listitem><para>CHECK (((lng &gt;= ((-180))::double precision) AND (lng &lt;= (180)::double precision)))</para></listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.typerevision"
               xreflabel="public.typerevision">
        <title id="public.table.typerevision-title">
         Table:
         
         <structname>typerevision</structname>
        </title>
 

        <para>
          Product may be have one associated category or type, e.g. &quot;Milk Products&quot;. This table stores information about categories/types.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>typerevision</structname>
            </title>


            <varlistentry>
              <term><structfield>type_id</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>






















                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>



                <literal>REFERENCES</literal> <xref linkend="public.table.producttype"/>


              </para>

              <para>
                Globally unique id to identifies an entity, i.e. the productType in this case.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>rev</structfield></term>
              <listitem><para>
                <type>integer</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                The revision# of this type.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>parent_id</structfield></term>
              <listitem><para>
                <type>bigint</type>












                <literal>REFERENCES</literal> <xref linkend="public.table.producttype"/>


              </para>

              <para>
                Categories/types may be grouped in an own type-hierarchy. E.g. category &quot;Milk Products&quot; has a subcategory &quot;Milk Shakes&quot;. The parent_id may be null if no parent category is specified.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.unit"
               xreflabel="public.unit">
        <title id="public.table.unit-title">
         Table:
         
         <structname>unit</structname>
        </title>
 

        <para>
          Stores the ids of all unitrevisions.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>unit</structname>
            </title>


            <varlistentry>
              <term><structfield>unit_id</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.entity"/>


              </para>

              <para>
                Globally unique id to identify an entity, i.e. the unit in this case.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing entityproperty via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="public.table.entityproperty"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.propertyrevision"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.unitrevision"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.unitrevision"
               xreflabel="public.unitrevision">
        <title id="public.table.unitrevision-title">
         Table:
         
         <structname>unitrevision</structname>
        </title>
 

        <para>
          Stores informations of units.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>unitrevision</structname>
            </title>


            <varlistentry>
              <term><structfield>unit_id</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>






















                <literal>REFERENCES</literal> <xref linkend="public.table.unit"/>



                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                Globally unique id to identify an entity, i.e. the unit in this case.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>rev</structfield></term>
              <listitem><para>
                <type>integer</type>


                <literal>PRIMARY KEY</literal>


















                <literal>REFERENCES</literal> <xref linkend="public.table.entityrevision"/>


              </para>

              <para>
                The revision# of the unit.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>base_id</structfield></term>
              <listitem><para>
                <type>bigint</type>












                <literal>REFERENCES</literal> <xref linkend="public.table.unit"/>


              </para>

              <para>
                Units may have a base unit specified, e.g. a base unit for the unit &quot;miles&quot; might be &quot;kilometers&quot;, thus the (conversion) factor is 1 : 1.6. The base unit must be set iff the factor is set.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>factor</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

              <para>
                Units may have a base unit and a (conversion) factor specified, e.g. a base unit for the unit &quot;miles&quot; might be &quot;kilometers&quot; the factor is 1 : 1.6. The base unit must be set iff the factor is set.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on unitrevision</title>

          <varlistentry>
            <term>unitrevision_check</term>
            <listitem><para>CHECK (((base_id IS NULL) = (factor IS NULL)))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>unitrevision_factor_check</term>
            <listitem><para>CHECK ((factor &lt;&gt; (0)::double precision))</para></listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>



  </chapter>

</book>

